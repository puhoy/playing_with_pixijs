!function(t){function e(e){for(var i,s,a=e[0],h=e[1],u=e[2],p=0,c=[];p<a.length;p++)s=a[p],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&c.push(r[s][0]),r[s]=0;for(i in h)Object.prototype.hasOwnProperty.call(h,i)&&(t[i]=h[i]);for(l&&l(e);c.length;)c.shift()();return o.push.apply(o,u||[]),n()}function n(){for(var t,e=0;e<o.length;e++){for(var n=o[e],i=!0,a=1;a<n.length;a++){var h=n[a];0!==r[h]&&(i=!1)}i&&(o.splice(e--,1),t=s(s.s=n[0]))}return t}var i={},r={0:0},o=[];function s(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=i,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(n,i,function(e){return t[e]}.bind(null,i));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="";var a=window.webpackJsonp=window.webpackJsonp||[],h=a.push.bind(a);a.push=e,a=a.slice();for(var u=0;u<a.length;u++)e(a[u]);var l=h;o.push([118,1]),n()}({118:function(t,e,n){"use strict";n.r(e);n(20),n(49),n(60),n(96);var i=n(2);function r(t,e,n,i,r,o,s){try{var a=t[o](s),h=a.value}catch(t){return void n(t)}a.done?e(h):Promise.resolve(h).then(i,r)}function o(){var t;return t=regeneratorRuntime.mark(function t(e){var n,r,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=i.b,r="WebGL",i.f.isWebGLSupported()||(r="canvas"),i.f.sayHello(r),o=new n({width:512,height:512,antialias:!1,transparent:!1,resolution:1}),document.body.appendChild(o.view),t.abrupt("return",new Promise(function(t,n){o.loader.add(e).load(function(){return t(o)})}));case 7:case"end":return t.stop()}},t)}),(o=function(){var e=this,n=arguments;return new Promise(function(i,o){var s=t.apply(e,n);function a(t){r(s,i,o,a,h,"next",t)}function h(t){r(s,i,o,a,h,"throw",t)}a(void 0)})}).apply(this,arguments)}var s=function(t){return o.apply(this,arguments)};n(63),n(68),n(69),n(43),n(73),n(74);function a(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var h=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.mapJson=e,this.textures=n,this.tileWidth,this.tileHeight,this.tileCountX,this.tileCountY,this.collisionMap,this.tiles=this.createSprites()}var e,n,r;return e=t,(n=[{key:"getCollisions",value:function(t,e){var n=this._getSpritesUnderCoords(t,e),i=!0,r=!1,o=void 0;try{for(var s,a=n[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){var h=s.value;if(h&&h.canCollide)return!0}}catch(t){r=!0,o=t}finally{try{i||null==a.return||a.return()}finally{if(r)throw o}}return!1}},{key:"_getSpritesUnderCoords",value:function(t,e){var n=[],i=!0,r=!1,o=void 0;try{for(var s,a=this.collisionMap[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){var h=s.value,u=Math.floor(t/this.tileWidth),l=Math.floor(e/this.tileHeight)*this.tileCountX+u;n.push(h[l])}}catch(t){r=!0,o=t}finally{try{i||null==a.return||a.return()}finally{if(r)throw o}}return n}},{key:"createSprites",value:function(){var t=0,e=0;this.tileWidth=this.mapJson.tile_dimensions.width,this.tileHeight=this.mapJson.tile_dimensions.height,this.tileCountY=this.mapJson.layers[0].length,this.tileCountX=this.mapJson.layers[0][0].length;var n=[];this.collisionMap=[];var r=!0,o=!1,s=void 0;try{for(var a,h=this.mapJson.layers[Symbol.iterator]();!(r=(a=h.next()).done);r=!0){var u=a.value,l=[];this.collisionMap.push(l);var p=!0,c=!1,d=void 0;try{for(var f,v=u[Symbol.iterator]();!(p=(f=v.next()).done);p=!0){var y=f.value,w=!0,g=!1,m=void 0;try{for(var x,b=y[Symbol.iterator]();!(w=(x=b.next()).done);w=!0){var _=x.value,C=this.getTilePath(_);if(C){var O=new i.e(this.textures[C]);O.x=t,O.y=e,O.canCollide=this.mapJson.can_collide[_]||!1,n.push(O),l.push(O)}else l.push(null);t+=this.tileWidth}}catch(t){g=!0,m=t}finally{try{w||null==b.return||b.return()}finally{if(g)throw m}}t=0,e+=this.tileHeight}}catch(t){c=!0,d=t}finally{try{p||null==v.return||v.return()}finally{if(c)throw d}}t=0,e=0}}catch(t){o=!0,s=t}finally{try{r||null==h.return||h.return()}finally{if(o)throw s}}return n}},{key:"spawnPlayer",value:function(){return this._getLocationInArea("player_spawn")}},{key:"spawnItem",value:function(){return this._getLocationInArea("item_spawn")}},{key:"_getLocationInArea",value:function(t){var e=this.mapJson.areas[t].x_start*this.tileWidth,n=this.mapJson.areas[t].y_start*this.tileHeight,i=this.mapJson.areas[t].x_end*this.tileWidth,r=this.mapJson.areas[t].y_end*this.tileHeight;return[Math.random()*(i-e)+e,Math.random()*(r-n)+n]}},{key:"getTilePath",value:function(t){var e=this.mapJson.tile_mapping[t];if(t&&!e&&console.error("cannot find ".concat(t," in mapping!")),Array.isArray(e)){var n=e;return n[Math.floor(Math.random()*n.length)]}return e}}])&&a(e.prototype,n),r&&a(e,r),t}();var u,l=function(){function t(t,e,n,r){void 0===n&&(n=[0,0]),void 0===r&&(r="idle"),this.textures=e,this.definition=t,this.state=r,this.sprite=this._getSprite(),this.container=new i.c,this.container.addChild(this.sprite),this.container.x=n[0],this.container.y=n[1]}return t.prototype._getSprite=function(){var t=i.a.fromFrames(this.definition.states[this.state].textures);return t.animationSpeed=this.definition.states[this.state].speed,t.play(),t},t.prototype.updateLayersOrder=function(){this.container.children.sort(function(t,e){return t.zIndex=t.zIndex||0,e.zIndex=e.zIndex||0,e.zIndex-t.zIndex})},t.prototype.animate=function(){for(var t=[],e=0,n=this.definition.states[this.state].textures;e<n.length;e++){var i=n[e];t.push(this.textures[i])}this.sprite.textures=t,this.sprite.animationSpeed=this.definition.states[this.state].speed,this.sprite.play()},t.prototype.move=function(t){return this.state},t.prototype.moveAndAnimate=function(t){var e=this.move(t);e!==this.state&&(this.state=e,this.animate())},t.prototype.collidesWith=function(t){return function(t,e){t.centerX=t.x+t.width/2,t.centerY=t.y+t.height/2,e.centerX=e.x+e.width/2,e.centerY=e.y+e.height/2,t.halfWidth=t.width/2,t.halfHeight=t.height/2,e.halfWidth=e.width/2,e.halfHeight=e.height/2;var n=!1;return Math.abs(t.centerX-e.centerX)<t.halfWidth+e.halfWidth&&Math.abs(t.centerY-e.centerY)<t.halfHeight+e.halfHeight&&(n=!0),n}(t.container,this.container)},t.prototype.coordsTopLeft=function(){return[this.container.x,this.container.y]},t.prototype.coordsTopRight=function(){return[this.container.x+this.container.width,this.container.y]},t.prototype.coordsBottomRight=function(){return[this.container.x+this.container.width,this.container.y+this.container.height]},t.prototype.coordsBottomLeft=function(){return[this.container.x,this.container.y+this.container.height]},t}(),p=(u=function(t,e){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}u(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),c=function(t){function e(e,n,i){void 0===i&&(i=[0,0]);var r=t.call(this,e,n,i)||this;return r.sprite.zIndex=0,r.velocity=e.velocity,r.vx=0,r.vy=0,r.equipped,r}return p(e,t),e.prototype.move=function(t){var e="idle";return this.vx<0?(e="running",this.sprite.scale.x=-1,this.sprite.anchor.set(1,0),this.equipped&&(this.equipped.sprite.zIndex=1,this.updateLayersOrder(),this.equipped.sprite.angle=10,this.equipped.sprite.x=5),(t.getCollisions.apply(t,this.coordsBottomLeft())||t.getCollisions.apply(t,this.coordsTopLeft()))&&(this.vx=1)):this.vx>0&&(e="running",this.sprite.scale.x=1,this.sprite.anchor.set(0,0),this.equipped&&(this.equipped.sprite.zIndex=-1,this.updateLayersOrder(),this.equipped.sprite.angle=-10,this.equipped.sprite.x=10),(t.getCollisions.apply(t,this.coordsBottomRight())||t.getCollisions.apply(t,this.coordsTopRight()))&&(this.vx=-1)),this.vy<0?(e="running",(t.getCollisions.apply(t,this.coordsTopLeft())||t.getCollisions.apply(t,this.coordsTopRight()))&&(this.vy=1)):this.vy>0&&(e="running",(t.getCollisions.apply(t,this.coordsBottomLeft())||t.getCollisions.apply(t,this.coordsBottomRight()))&&(this.vy=-1)),this.container.x+=this.vx,this.container.y+=this.vy,e},e.prototype.equip=function(t){this.equipped=t,this.equipped.sprite.y=this.sprite.height+4,this.container.addChild(t.sprite)},e}(l);function d(t){var e={};e.value=t,e.isDown=!1,e.isUp=!0,e.press=void 0,e.release=void 0,e.downHandler=function(t){t.key===e.value&&(e.isUp&&e.press&&e.press(),e.isDown=!0,e.isUp=!1,t.preventDefault())},e.upHandler=function(t){t.key===e.value&&(e.isDown&&e.release&&e.release(),e.isDown=!1,e.isUp=!0,t.preventDefault())};var n=e.downHandler.bind(e),i=e.upHandler.bind(e);return window.addEventListener("keydown",n,!1),window.addEventListener("keyup",i,!1),e.unsubscribe=function(){window.removeEventListener("keydown",n),window.removeEventListener("keyup",i)},e}var f,v,y,w,g,m,x,b,_=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),C=function(t){function e(e,n,i,r){void 0===i&&(i=[0,0]),void 0===r&&(r="idle");var o=t.call(this,e,n,i,r)||this;return o.sprite.anchor.set(.5),o.sprite.pivot.set(o.sprite.width/2,o.sprite.height/2),o.sprite.angle=360*Math.random(),o}return _(e,t),e}(l),O=[],j=[];var P=d("ArrowLeft"),S=d("ArrowUp"),k=d("ArrowRight"),L=d("ArrowDown"),M=function(t){y.vx=0,y.vy=0,P.isDown&&!k.isDown&&(y.vx=-y.velocity),!P.isDown&&k.isDown&&(y.vx=y.velocity),S.isDown&&!L.isDown&&(y.vy=-y.velocity),!S.isDown&&L.isDown&&(y.vy=y.velocity);for(var e=0,n=O;e<n.length;e++){n[e].moveAndAnimate(w)}for(var i=0,r=j;i<r.length;i++){var o=r[i];o.collidesWith(y)&&(y.equip(o),x.removeChild(o.container))}var s=g/2,a=m/2,h=y.container.width/2,u=y.container.height/2;x.x=-y.container.x-h+s,x.y=-y.container.y-u+a},A=function(t){v(t)};var D=function(t){f=(b=t).loader.resources["assets/sprites/dungeon.json"].textures;var e=new h(b.loader.resources["assets/maps/room.json"].data,f);g=b.renderer.width,m=b.renderer.height,x=new i.c;var n=new i.d,r=!0,o=!1,s=void 0;try{for(var a,u=e.tiles[Symbol.iterator]();!(r=(a=u.next()).done);r=!0){var l=a.value;n.addChild(l)}}catch(t){o=!0,s=t}finally{try{r||null==u.return||u.return()}finally{if(o)throw s}}x.addChild(n),w=e;var p=new c(b.loader.resources["assets/chars/wizzard.json"].data,f,e.spawnPlayer());x.addChild(p.container),O.push(p),y=p;var d=new C(b.loader.resources["assets/weapons/green_staff.json"].data,f,e.spawnItem());x.addChild(d.container),j.push(d),b.stage.addChild(x),v=M,b.ticker.add(function(t){return A(t)})};function H(t,e,n,i,r,o,s){try{var a=t[o](s),h=a.value}catch(t){return void n(t)}a.done?e(h):Promise.resolve(h).then(i,r)}function I(){var t;return t=regeneratorRuntime.mark(function t(){var e,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=["assets/sprites/dungeon.json","assets/maps/room.json","assets/chars/wizzard.json","assets/weapons/green_staff.json"],t.next=3,s(e);case 3:n=t.sent,D(n);case 5:case"end":return t.stop()}},t)}),(I=function(){var e=this,n=arguments;return new Promise(function(i,r){var o=t.apply(e,n);function s(t){H(o,i,r,s,a,"next",t)}function a(t){H(o,i,r,s,a,"throw",t)}s(void 0)})}).apply(this,arguments)}!function(){I.apply(this,arguments)}()},96:function(t,e,n){}});
//# sourceMappingURL=app.4649fb8a.js.map